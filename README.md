# AUX-IN Switcher for the Teufel 3sixty Radio

## Problem

- A 3sixty radio from Teufel - no, this part is not the problem!
- Has lot of cool things but no AirPlay
- And the Spotify client has a few issues (or maybe it's only my local net)

## Solution

- A Raspberry Pi with shairport-sync and raspotify on the auxiliary input

## New Problem

- I want to auto-switch the 3sixty to the aux input when the Raspi starts playing

## New Solution

- The 3sixty has a Frontier Silicon chipset.
- Frontier Silicon built a REST-like HTTP API into the chipset.

So - 

- I wrote a Go program that detects when music starts playing
- The program then 
  - wakes up the 3sixty if needed,
  - saves the previous source, 
  - and switches the radio to aux-in.
- If music stops playing, the program
  - checks if the radio was switched to a different source in the meantime
  - if so, the program leaves the radio alone
  - else it switches back to the previous source
  - and puts the radio into standby mode.

The Go code started from code generated by Postman.

The Postman queries were based on [this inofficial FSAPI doc](https://github.com/flammy/fsapi/blob/master/FSAPI.md).

Detecting if the Raspi plays music is easy once you [find out how]((https://howchoo.com/linux/how-to-detect-that-audio-is-currently-being-output-in-linux-and-use-it-to-call-a-program#create-an-audio-output-monitor-script)) - `cat /proc/asound/card1/pcm0p/sub0/status` is the command line version. 

Go code compiles to a single binary with no dependencies. And Go can cross-compile to a different architecture without the need for installing the target system's compiler toolchain locally. These attributes of Go make it super easy to `scp` the program to the Raspi and run it as a `systemd` service. No complicated build/deploy routines needed (but setting up the `systemd` files is still a manual step; templates included in the repo). 

## Disclaimer

I built this project for my own purposes (obviously) but I am happy to share it here in case anybody else has a 3sixty (or some other Frontier Silicon based radio) and wonders how to auto-switch to aux-in in case a Raspi plays music.
